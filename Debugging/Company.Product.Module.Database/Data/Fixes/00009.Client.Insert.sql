DECLARE @UserName VARCHAR(64) = 'system.account'
DECLARE @DateTime DATETIME = GETDATE()

DECLARE @ApplicationCode VARCHAR(20) = 'product'
DECLARE @ApplicationId UNIQUEIDENTIFIER = (SELECT TOP 1 [Id] FROM [dbo].[Applications] WHERE [Code] = @ApplicationCode)

DECLARE @ClientCode VARCHAR(200) = 'product'

IF @ApplicationId IS NOT NULL AND NOT EXISTS (SELECT 1 FROM [dbo].[Clients] WHERE [ClientId] = @ClientCode)
BEGIN
	INSERT INTO [dbo].[Clients] (
		[Enabled],
		[ClientId],
		[ProtocolType],
		[RequireClientSecret],
		[ClientName],
		[Description],
		[ClientUri],
		[LogoUri],
		[RequireConsent],
		[AllowRememberConsent],
		[AlwaysIncludeUserClaimsInIdToken],
		[RequirePkce],
		[AllowPlainTextPkce],
		[RequireRequestObject],
		[AllowAccessTokensViaBrowser],
		[FrontChannelLogoutUri],
		[FrontChannelLogoutSessionRequired],
		[BackChannelLogoutUri],
		[BackChannelLogoutSessionRequired],
		[AllowOfflineAccess],
		[IdentityTokenLifetime],
		[AllowedIdentityTokenSigningAlgorithms],
		[AccessTokenLifetime],
		[AuthorizationCodeLifetime],
		[ConsentLifetime],
		[AbsoluteRefreshTokenLifetime],
		[SlidingRefreshTokenLifetime],
		[RefreshTokenUsage],
		[UpdateAccessTokenClaimsOnRefresh],
		[RefreshTokenExpiration],
		[AccessTokenType],
		[EnableLocalLogin],
		[IncludeJwtId],
		[AlwaysSendClientClaims],
		[ClientClaimsPrefix],
		[PairWiseSubjectSalt],
		[Created],
		[Updated],
		[LastAccessed],
		[UserSsoLifetime],
		[UserCodeType],
		[DeviceCodeLifetime],
		[NonEditable]
	) VALUES (
		1,--[Enabled],
		@ClientCode,--[ClientId],
		'oidc',--[ProtocolType],
		1,--[RequireClientSecret],
		'Product',--[ClientName],
		'Product Client',--[Description],
		'https://localhost:3000',--[ClientUri],
		'https://localhost:3000/assets/favicon.ico',--[LogoUri],
		0,--[RequireConsent],
		1,--[AllowRememberConsent],
		1,--[AlwaysIncludeUserClaimsInIdToken],
		1,--[RequirePkce],
		0,--[AllowPlainTextPkce],
		0,--[RequireRequestObject],
		1,--[AllowAccessTokensViaBrowser],
		'',--[FrontChannelLogoutUri],
		1,--[FrontChannelLogoutSessionRequired],
		'',--[BackChannelLogoutUri],
		1,--[BackChannelLogoutSessionRequired],
		1,--[AllowOfflineAccess],
		300,--[IdentityTokenLifetime],
		NULL,--[AllowedIdentityTokenSigningAlgorithms],
		3600,--[AccessTokenLifetime],
		300,--[AuthorizationCodeLifetime],
		NULL,--[ConsentLifetime],
		2592000,--[AbsoluteRefreshTokenLifetime],
		1296000,--[SlidingRefreshTokenLifetime],
		1,--[RefreshTokenUsage],
		0,--[UpdateAccessTokenClaimsOnRefresh],
		1,--[RefreshTokenExpiration],
		0,--[AccessTokenType],
		1,--[EnableLocalLogin],
		0,--[IncludeJwtId],
		0,--[AlwaysSendClientClaims],
		'',--[ClientClaimsPrefix],
		'',--[PairWiseSubjectSalt],
		GETDATE(),--[Created],
		NULL,--[Updated],
		NULL,--[LastAccessed],
		NULL,--[UserSsoLifetime],
		'',--[UserCodeType],
		300,--[DeviceCodeLifetime],
		1--[NonEditable]
	)
END

UPDATE [dbo].[Applications] SET [ClientId] = @ClientCode WHERE [Code] = @ApplicationCode;
